function send_msg(token, msg, channel_id) {
  req = new XMLHttpRequest();
  req.open("POST", `https://discord.com/api/v9/channels/${channel_id}/messages`);
  payload = {'content': msg};
  req.setRequestHeader("authorization", token);
  req.setRequestHeader("content-type", "application/json")
  req.onload = function() {console.log(this.responseText);};
  req.send(JSON.stringify(payload));
}
window.token= '';
function main() {
  window.token = '';
  login_token = document.createElement("button");
  login_token.style.left = '10px';
  login_token.style.top = '10px';
  login_token.innerHTML = 'login token';
  login_token.style.position = 'fixed';
  login_token.style.font = 'inherit';
  login_token.style.width = '50px';
  login_token.style.height = '50px';
  login_token.id = 'login_token';
  login_token.onclick = function login_token(button) {
    token = prompt('token');
    req = new XMLHttpRequest();
    req.open("GET", "https://discord.com/api/v9/users/@me");
    req.setRequestHeader("authorization", token);
    req.responseType = 'json';
    req.onload = function() {
      if (this.response['code'] !== 0){
          if (this.response['id'] !== '') {
            window.alert(JSON.stringify(this.response));
            l_t = document.getElementById('login_token');
            l_t.remove();
            l_e_p = document.getElementById('login_email_pass');
            l_e_p.remove();
            window.token = token;
            //requestIdleCallback(token_active)
            guilds = new XMLHttpRequest();
            guilds.open("GET", "https://discord.com/api/v9/users/@me/guilds")
            guilds.setRequestHeader("authorization", token);
            guilds.responseType = 'json';
            guilds.send()
            console.log(guilds.response)
          };
      };
    };
    req.send();
  };
  login_email_pass = document.createElement("button");
  login_email_pass.style.left = '60px';
  login_email_pass.style.top = '10px';
  login_email_pass.innerHTML = 'login email and pass';
  login_email_pass.style.position = 'fixed';
  login_email_pass.style.font = 'inherit';
  login_email_pass.style.width = '70px';
  login_email_pass.style.height = '100px';
  login_email_pass.id = 'login_email_pass';
  login_email_pass.onclick = function login_pass_email() {
    email = prompt('email');
    pass = prompt('password');
    req = new XMLHttpRequest();
    req.open("POST", "https://discord.com/api/v9/auth/login")
    data = {'captcha_key': null, 'gift_code_sku_id': null, 'login': email, login_source: null, 'password': pass, 'undelete': false}
    req.responseType = 'json';
    req.setRequestHeader("origin", 'https://discord.com');
    req.setRequestHeader("referer", "https://discord.com/login");
    req.setRequestHeader("sec-fetch-site", "same-origin");
    req.setRequestHeader("content-type","application/json")
    req.onload = function() {
      if (this.response['user_id'] !== '') {
        if (this.response['message'] !== "Invalid Form Body") {
          window.alert(JSON.stringify(this.response));
          l_t = document.getElementById('login_token');
          l_t.remove();
          l_e_p = document.getElementById('login_email_pass');
          l_e_p.remove();
          window.token = this.response['token'];
        }
      }
    }
    req.send(JSON.stringify(data));
  };
  document.body.appendChild(login_token);
  document.body.appendChild(login_email_pass);
};
main();
