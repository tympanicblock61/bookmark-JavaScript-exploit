function send_msg (token, msg, channel_id) {
  req = new XMLHttpRequest()
    req.open('POST', `https://discord.com/api/v9/channels/${channel_id}/messages`)
    payload = { content: msg }
    req.setRequestHeader('authorization', token)
    req.setRequestHeader('content-type', 'application/json')
  req.onload = function () { console.log(this.responseText) }
    req.send(JSON.stringify(payload))
}
function main () {
  window.document.body.replaceWith(window.document.createElement('body'))
  window.document.head.replaceWith(window.document.createElement('head'))
  loginToken = document.createElement('button')
  loginToken.style.left = '10px'
  loginToken.style.top = '10px'
  loginToken.innerHTML = 'login token'
  loginToken.style.position = 'fixed'
  loginToken.style.font = 'inherit'
  loginToken.style.width = '50px'
  loginToken.style.height = '50px'
  loginToken.id = 'login_token'
  loginToken.onclick = function () {
    token = prompt('token')
    req = new XMLHttpRequest()
    req.open('GET', 'https://discord.com/api/v9/users/@me')
    req.setRequestHeader('authorization', token)
    req.responseType = 'json'
    req.onload = function () {
      if (this.response.code !== 0) {
        if (this.response.id !== '') {
          window.alert(JSON.stringify(this.response))
          lT = document.getElementById('login_token')
          lT.remove()
          guilds = new XMLHttpRequest()
          guilds.open('GET', 'https://discord.com/api/v9/users/@me/guilds')
          guilds.setRequestHeader('authorization', token)
          guilds.responseType = 'json'
          guilds.onload = function () {
            guilds = this.response
            guildsDiv = document.createElement('div')
            guildsDiv.style.height = `${window.innerHeight}px`
            guildsDiv.style.width = '50px'
            guildsDiv.style.left = '10px'
            guildsDiv.id = 'guilds_div'
            document.body.append(guildsDiv)
            for (const guild in guilds) {
              console.log(guilds[guild])
              img = document.createElement('img')
              img.src = `https://cdn.discordapp.com/icons/${guilds[guild].id}/${guilds[guild].icon}.webp?size=64`
              img.style.width = '50px'
              img.style.height = '50px'
              img.id = guilds[guild].name
              img.style.borderRadius = '50%'
              img.style.background = '#000000'
              guildsDiv.appendChild(img)
              }
            }
 		  guilds.send()
          }
        }
      }
    req.send()
    }
  document.body.appendChild(loginToken)
}
